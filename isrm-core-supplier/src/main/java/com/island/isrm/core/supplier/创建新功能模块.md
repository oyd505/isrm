# 创建新功能模块
- 在指定的子模块创建后端代码和前端代码
- 后端使用[DDD](https://xie.infoq.cn/article/e448ac374baae7612d7cd057d) + [Spring-boot](https://spring.io/projects/spring-boot)
- 前端使用[Vue3](https://cn.vuejs.org/guide/introduction.html) + [View UI Plus](https://www.iviewui.com/view-ui-plus/guide/introduce) + [Vue Router](https://router.vuejs.org/zh/guide/)

## 创建后端代码
> 后端代码使用六边形架构，先创建核心领域层，再创建应用层，最后创建适配层（包括基础实施层）

### 创建领域层代码
- 创建聚合、聚合根
```java
package com.island.isrm.core.supplier.domain.entity;

import com.island.isrm.core.common.domain.BaseEntity;
import com.island.isrm.core.common.domain.dp.Name;
import com.island.isrm.core.common.exception.BizException;
import com.island.isrm.core.supplier.domain.dp.SupplierCode;
import com.island.isrm.core.supplier.domain.dp.SupplierStatus;
import lombok.EqualsAndHashCode;
import lombok.Getter;
import lombok.Setter;
import lombok.experimental.Accessors;
import lombok.extern.slf4j.Slf4j;

import java.util.ArrayList;
import java.util.List;
import java.util.Optional;

/**
 * 供应商
 *
 * @author dao.ouyang
 * @since 2024-12-15
 */
@Slf4j
@EqualsAndHashCode(callSuper = true)
@Getter
@Accessors(chain = true)
public class Supplier extends BaseEntity {

    // 供应商编码
    private final SupplierCode supplierCode;
    // 供应商名称
    @Setter
    private Name name;
    // 供应商状态
    private final SupplierStatus supplierStatus;
    // 供应商联系人列表
    private final List<SupplierContact> supplierContacts = new ArrayList<>();

    /**
     * 构造方法，初始化供应商实例
     * 
     * @param supplierCode 供应商编码
     * @param supplierStatus 供应商状态
     */
    public Supplier(SupplierCode supplierCode, SupplierStatus supplierStatus) {
        this.supplierCode = supplierCode;
        this.supplierStatus = supplierStatus;
    }

    /**
     * 检查供应商是否可编辑
     * 根据供应商状态判断是否允许进行编辑操作，如果不允许，则抛出业务异常
     * 
     * @throws BizException 如果供应商状态不允许编辑，则抛出此异常
     */
    public void checkEditable() {
        if (!this.supplierStatus.isEditable()) {
            throw new BizException(SupplierStatus.POTENTIAL.name() + " 状态的供应商才允许编辑操作");
        }
    }

    /**
     * 更新供应商信息
     * 在确保当前供应商可编辑的前提下，用另一个供应商实例的信息来更新当前供应商的信息
     * 
     * @param supplier 包含更新信息的供应商实例
     */
    public void update(Supplier supplier) {
        this.checkEditable();
        this.name = supplier.getName();
    }

    /**
     * 添加联系人
     * 将一个新的联系人添加到供应商的联系人列表中
     * 
     * @param supplierContact 要添加的供应商联系人实例
     */
    public void addContact(SupplierContact supplierContact) {
        this.supplierContacts.add(supplierContact);
    }

    /**
     * 更新联系人信息
     * 根据联系人的唯一标识符找到供应商的对应联系人，并用新的联系人信息进行更新
     * 
     * @param supplierContact 包含更新信息的供应商联系人实例
     */
    public void updateContact(SupplierContact supplierContact) {
        Optional<SupplierContact> supplierContactOptional = this.supplierContacts.stream()
                .filter(contact -> contact.getSupplierContactId().equals(supplierContact.getSupplierContactId()))
                .findFirst();
        supplierContactOptional.ifPresent(contact -> contact.update(supplierContact));
    }
}
```
- 创建聚合根包含的值对象
```java
package com.island.isrm.core.supplier.domain.dp;

import com.island.isrm.core.common.domain.dp.Code;
import org.springframework.util.Assert;

/**
 * 供应商编码
 *
 * @author dao.ouyang
 * @since 2024-12-15
 */
public class SupplierCode extends Code {
    public SupplierCode(String value) {
        super(value);
        Assert.hasText(value, "供应商编码不能为空");
    }
}
```
```java
package com.island.isrm.core.supplier.domain.dp;

/**
 * 供应商状态
 *
 * @author dao.ouyang
 * @since 2024-12-15
 */
public enum SupplierStatus {
    /**
     * 临时
     */
    TEMPORARY,
    /**
     * 潜在
     */
    POTENTIAL {
        @Override
        public boolean isEditable() {
            return true;
        }
    },
    /**
     * 引入中
     */
    INTRODUCING,
    /**
     * 合格
     */
    QUALIFIED,
    /**
     * 已退出
     */
    EXITED;

    public boolean isEditable() {
        return false;
    }
}
```
- 创建关联领域实体，如果业务简单，没有关联实体的话，可以不创建
```java
package com.island.isrm.core.supplier.domain.entity;

import com.island.isrm.core.common.domain.BaseEntity;
import com.island.isrm.core.supplier.domain.dp.Contact;
import com.island.isrm.core.supplier.domain.dp.SupplierCode;
import com.island.isrm.core.supplier.domain.dp.SupplierContactId;
import lombok.EqualsAndHashCode;
import lombok.Getter;
import lombok.Setter;
import lombok.experimental.Accessors;

/**
 * 供应商联系人
 *
 * @author dao.ouyang
 * @since 2024-12-15
 */
@EqualsAndHashCode(callSuper = true)
@Getter
@Accessors(chain = true)
public class SupplierContact extends BaseEntity {
    // 供应商联系人ID
    private final SupplierContactId supplierContactId;
    // 供应商编码
    private final SupplierCode supplierCode;
    // 联系人
    @Setter
    private Contact contact;

    /**
     * 构造方法
     *
     * 初始化供应商联系人对象，设置供应商联系人ID和供应商编码
     *
     * @param supplierContactId 供应商联系人ID
     * @param supplierCode 供应商编码
     */
    public SupplierContact(SupplierContactId supplierContactId, SupplierCode supplierCode) {
        this.supplierContactId = supplierContactId;
        this.supplierCode = supplierCode;
    }

    /**
     * 更新供应商联系人信息
     *
     * 此方法用于更新供应商联系人的联系人信息部分
     * 它通过传入一个新的供应商联系人对象来更新当前对象的联系人信息
     *
     * @param supplierContact 新的供应商联系人对象，包含更新的联系人信息
     */
    public void update(SupplierContact supplierContact) {
        this.contact = supplierContact.getContact();
    }
}
```
- 创建领域实体包含的值对象
```java
package com.island.isrm.core.supplier.domain.dp;

import lombok.Data;
import lombok.NonNull;

/**
 * 供应商联系人标识类
 *
 * @author dao.ouyang
 * @since 2024-12-15
 */
@Data
public class SupplierContactId {
    /**
     * 供应商联系人的唯一标识
     */
    @NonNull
    private final Long id;
}
```
```java
package com.island.isrm.core.supplier.domain.dp;

import lombok.Data;

/**
 * 供应商的联系人
 *
 * @author dao.ouyang
 * @since 2024-12-15
 */
@Data
public class Contact {
    /**
     * 姓名
     */
    private final String name;

    /**
     * 电话号码
     */
    private final String phone;
}
```
- 创建领域服务
> 如果领域服务的具体逻辑处理依赖基础实施层，则只创建接口，实现类在适配层中实现
```java
package com.island.isrm.core.supplier.domain.external;

import com.island.isrm.core.supplier.domain.dp.SupplierCode;

/**
 * 供应商编码服务
 *
 * @author dao.ouyang
 * @since 2024-12-15
 */
public interface SupplierCodeService {

    /**
     * 生成供应商编码
     *
     * @return 供应商编码
     */
    SupplierCode generateSerialNumber();
}
```
> 如果领域服务的具体逻辑处理不依赖于基础实施层，则可以直接在领域服务中实现
```java
package com.island.isrm.core.idaccess.domain.service;

import com.island.isrm.core.idaccess.domain.dp.UserRole;
import com.island.isrm.core.idaccess.domain.dp.UserStatus;
import com.island.isrm.core.idaccess.domain.dp.UserType;
import com.island.isrm.core.idaccess.domain.entity.User;
import org.springframework.stereotype.Service;

import java.util.List;

@Service
public class UserStatusService {

    public UserStatus init(UserType userType) {
        if (userType.isAdmin()) {
            return new UserStatus(String.join(",", UserRole.BUYER.name(), UserRole.VENDOR.name()), false, false);
        } else if (userType.isExternal()) {
            return new UserStatus(UserRole.VENDOR.name(), false, false);
        } else {
            return new UserStatus(UserRole.BUYER.name(), false, false);
        }
    }

    public void updateRoles(User user, List<String> roles) {
        UserStatus userStatus = new UserStatus(String.join(",", roles),
                user.getUserStatus().isDisabled(), user.getUserStatus().isAccountLocked());
        user.setUserStatus(userStatus);
    }

    public void updateDisabled(User user, boolean disabled) {
        UserStatus userStatus = new UserStatus(user.getUserStatus().getRoles()
                , disabled, user.getUserStatus().isAccountLocked());
        user.setUserStatus(userStatus);
    }

    public void updateAccountLocked(User user, boolean accountLocked) {
        UserStatus userStatus = new UserStatus(user.getUserStatus().getRoles(),
                user.getUserStatus().isDisabled(), accountLocked);
        user.setUserStatus(userStatus);
    }
}
```
- 创建仓储接口
```java
package com.island.isrm.core.supplier.domain.repo;

import com.island.isrm.core.supplier.domain.dp.SupplierCode;
import com.island.isrm.core.supplier.domain.dp.SupplierContactId;
import com.island.isrm.core.supplier.domain.entity.Supplier;

/**
 * 供应商仓储
 *
 * @author dao.ouyang
 * @since 2024-12-15
 */
public interface SupplierRepository {
    /**
     * 根据供应商编码查询供应商
     *
     * @param supplierCode 供应商编码
     * @return 供应商
     */
    Supplier find(SupplierCode supplierCode);

    /**
     * 新增供应商
     *
     * @param supplier 供应商
     * @return 供应商编码
     */
    SupplierCode add(Supplier supplier);

    void update(Supplier supplier);

    /**
     * 删除供应商及其关联联系人
     *
     * @param supplierCode 供应商编码
     */
    void removeAll(SupplierCode supplierCode);

    /**
     * 根据供应商编码和供应商联系人ID查询供应商联系人
     *
     * @param supplierCode      供应商编码
     * @param supplierContactId 供应商联系人ID
     * @return 供应商带有一个供应商联系人
     */
    Supplier findOneSupplierContact(SupplierCode supplierCode, SupplierContactId supplierContactId);

    /**
     * 添加一个联系人到供应商
     *
     * @param supplier 供应商
     * @return 供应商联系人ID
     */
    SupplierContactId addOneSupplierContact(Supplier supplier);

    /**
     * 更新供应商联系人
     *
     * @param supplier 供应商
     */
    void updateSupplierContact(Supplier supplier);

    /**
     * 移除一个供应商联系人
     *
     * @param supplierContactId 供应商联系人ID
     */
    void removeOneSupplierContact(SupplierContactId supplierContactId);
}
```
- 创建领域事件，如果领域事件需要在其他子模块中监听，则将领域事件定义在isrm-core-common模块中，否则定义在当前子模块中
```java
package com.island.isrm.core.common.domain.event;

import lombok.Getter;

@Getter
public class SupplierCreatedEvent extends DomainEvent {
    private final String supplierCode;
    private final String supplierName;

    public SupplierCreatedEvent(Object source, String supplierCode, String supplierName) {
        super(source);
        this.supplierCode = supplierCode;
        this.supplierName = supplierName;
    }
}
```

### 创建应用层代码
- 创建命令类
```java
package com.island.isrm.core.supplier.application.command;

import jakarta.validation.constraints.NotBlank;
import lombok.Data;

/**
 * 创建供应商命令类
 *
 * @author dao.ouyang
 * @since 2024-12-15
 */
@Data
public class CreateSupplierCmd {
    /**
     * 供应商名称
     */
    @NotBlank
    private String name;
}
```
```java
package com.island.isrm.core.supplier.application.command;

import jakarta.validation.constraints.NotBlank;
import lombok.Data;
import lombok.EqualsAndHashCode;

/**
 * 更新供应商命令类
 *
 * @author dao.ouyang
 * @since 2024-12-15
 */
@EqualsAndHashCode(callSuper = true)
@Data
public class UpdateSupplierCmd extends CreateSupplierCmd {
    /**
     * 需要更新的供应商编码
     */
    @NotBlank
    private String supplierCode;
}
```
- 创建组装器类
```java
package com.island.isrm.core.supplier.application;

import com.island.isrm.core.common.domain.dp.Name;
import com.island.isrm.core.supplier.application.command.AddSupplierContactCmd;
import com.island.isrm.core.supplier.application.command.CreateSupplierCmd;
import com.island.isrm.core.supplier.application.command.UpdateSupplierCmd;
import com.island.isrm.core.supplier.application.command.UpdateSupplierContactCmd;
import com.island.isrm.core.supplier.domain.dp.Contact;
import com.island.isrm.core.supplier.domain.dp.SupplierCode;
import com.island.isrm.core.supplier.domain.dp.SupplierContactId;
import com.island.isrm.core.supplier.domain.dp.SupplierStatus;
import com.island.isrm.core.supplier.domain.entity.Supplier;
import com.island.isrm.core.supplier.domain.entity.SupplierContact;

/**
 * 供应商组装器类，用于将命令对象转换为供应商实体对象
 *
 * @author dao.ouyang
 * @since 2024-12-15
 */
public class SupplierAssembler {
    // 单例模式，静态实例
    public final static SupplierAssembler instance = new SupplierAssembler();

    /**
     * 将创建供应商命令转换为供应商实体对象
     *
     * @param command        创建供应商命令对象
     * @param supplierCode   供应商编码
     * @param supplierStatus 供应商状态
     * @return 转换后的供应商实体对象
     */
    public Supplier toAddEntity(CreateSupplierCmd command, SupplierCode supplierCode, SupplierStatus supplierStatus) {
        Supplier supplier = new Supplier(supplierCode, supplierStatus);
        this.assemble(command, supplier);
        return supplier;
    }

    /**
     * 将创建供应商命令对象的属性复制到供应商实体对象中
     *
     * @param source 创建供应商命令对象
     * @param target 供应商实体对象
     */
    private void assemble(CreateSupplierCmd source, Supplier target) {
        target.setName(new Name(source.getName()));
    }

    /**
     * 将更新供应商命令转换为供应商实体对象
     *
     * @param command        更新供应商命令对象
     * @param supplierStatus 供应商状态
     * @return 转换后的供应商实体对象
     */
    public Supplier toUpdateEntity(UpdateSupplierCmd command, SupplierStatus supplierStatus) {
        Supplier update = new Supplier(new SupplierCode(command.getSupplierCode()), supplierStatus);
        this.assemble(command, update);
        return update;
    }

    /**
     * 将添加供应商联系人命令转换为供应商联系人实体对象
     *
     * @param supplierCode 供应商编码
     * @param command      添加供应商联系人命令对象
     * @return 转换后的供应商联系人实体对象
     */
    public SupplierContact toAddEntity(SupplierCode supplierCode, AddSupplierContactCmd command) {
        SupplierContact supplierContact = new SupplierContact(null, supplierCode);
        this.assemble(command, supplierContact);
        return supplierContact;
    }

    /**
     * 将添加供应商联系人命令对象的属性复制到供应商联系人实体对象中
     *
     * @param source 添加供应商联系人命令对象
     * @param target 供应商联系人实体对象
     */
    private void assemble(AddSupplierContactCmd source, SupplierContact target) {
        target.setContact(new Contact(source.getName(), source.getPhone()));
    }

    /**
     * 将更新供应商联系人命令转换为供应商联系人实体对象
     *
     * @param supplierCode 供应商编码
     * @param command      更新供应商联系人命令对象
     * @return 转换后的供应商联系人实体对象
     */
    public SupplierContact toUpdateEntity(SupplierCode supplierCode, UpdateSupplierContactCmd command) {
        SupplierContact update = new SupplierContact(new SupplierContactId(command.getId()), supplierCode);
        this.assemble(command, update);
        return update;
    }
}
```
- 创建应用服务接口
```java
package com.island.isrm.core.supplier.application;

import com.island.isrm.core.supplier.application.command.AddSupplierContactCmd;
import com.island.isrm.core.supplier.application.command.CreateSupplierCmd;
import com.island.isrm.core.supplier.application.command.UpdateSupplierCmd;
import com.island.isrm.core.supplier.application.command.UpdateSupplierContactCmd;
import com.island.isrm.core.supplier.domain.dp.SupplierCode;
import com.island.isrm.core.supplier.domain.dp.SupplierContactId;
import jakarta.validation.Valid;
import org.springframework.validation.annotation.Validated;

/**
 * 定义了供应商应用服务的接口
 *
 * @author dao.ouyang
 * @since 2024-12-15
 */
@Validated
public interface SupplierAppService {

    /**
     * 创建供应商
     *
     * @param command 包含创建供应商所需信息的命令对象，包括供应商的基本信息和可能的联系人信息等
     * @return 返回生成的供应商编码，作为供应商的唯一标识
     */
    SupplierCode create(@Valid CreateSupplierCmd command);

    /**
     * 更新供应商信息
     *
     * @param command 包含需要更新的供应商信息的命令对象，包括供应商编码和需要修改的信息
     */
    void update(@Valid UpdateSupplierCmd command);

    /**
     * 删除供应商
     *
     * @param supplierCode 需要删除的供应商的编码
     */
    void remove(SupplierCode supplierCode);

    /**
     * 为供应商添加新的联系人
     *
     * @param supplierCode 添加联系人的供应商的编码
     * @param command      包含需要添加的供应商联系人信息的命令对象
     * @return 返回生成的供应商联系人ID，作为联系人的唯一标识
     */
    SupplierContactId addContact(SupplierCode supplierCode, @Valid AddSupplierContactCmd command);

    /**
     * 更新供应商联系人信息
     *
     * @param supplierCode 需要更新联系人信息的供应商的编码
     * @param command      包含需要更新的供应商联系人信息的命令对象，包括联系人ID和需要修改的信息
     */
    void updateContact(SupplierCode supplierCode, @Valid UpdateSupplierContactCmd command);

    /**
     * 删除供应商联系人
     *
     * @param supplierCode      需要删除联系人的供应商的编码
     * @param supplierContactId 需要删除的供应商联系人的ID
     */
    void removeContact(SupplierCode supplierCode, SupplierContactId supplierContactId);
}
```
- 创建应用服务实现类
```java
package com.island.isrm.core.supplier.application.impl;

import com.island.isrm.core.common.domain.event.SupplierContactCreatedEvent;
import com.island.isrm.core.common.domain.event.SupplierCreatedEvent;
import com.island.isrm.core.common.domain.external.DomainEventPublisher;
import com.island.isrm.core.supplier.application.SupplierAppService;
import com.island.isrm.core.supplier.application.SupplierAssembler;
import com.island.isrm.core.supplier.application.command.AddSupplierContactCmd;
import com.island.isrm.core.supplier.application.command.CreateSupplierCmd;
import com.island.isrm.core.supplier.application.command.UpdateSupplierCmd;
import com.island.isrm.core.supplier.application.command.UpdateSupplierContactCmd;
import com.island.isrm.core.supplier.domain.dp.SupplierCode;
import com.island.isrm.core.supplier.domain.dp.SupplierContactId;
import com.island.isrm.core.supplier.domain.dp.SupplierStatus;
import com.island.isrm.core.supplier.domain.entity.Supplier;
import com.island.isrm.core.supplier.domain.entity.SupplierContact;
import com.island.isrm.core.supplier.domain.external.SupplierCodeService;
import com.island.isrm.core.supplier.domain.repo.SupplierRepository;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

/**
 * 供应商应用服务实现类
 *
 * @author dao.ouyang
 * @since 2024-12-15
 */
@Service
public class SupplierAppServiceImpl implements SupplierAppService {
    // 供应商组装器实例
    private final SupplierAssembler supplierAssembler = SupplierAssembler.instance;
    // 供应商仓储
    private final SupplierRepository supplierRepository;
    // 供应商编码服务
    private final SupplierCodeService supplierCodeService;
    // 应用事件发布器
    private final DomainEventPublisher publisher;

    /**
     * 构造函数注入所需服务和仓储
     */
    public SupplierAppServiceImpl(SupplierRepository supplierRepository, SupplierCodeService supplierCodeService, DomainEventPublisher publisher) {
        this.supplierRepository = supplierRepository;
        this.supplierCodeService = supplierCodeService;
        this.publisher = publisher;
    }

    /**
     * 创建供应商
     *
     * @param command 创建供应商命令
     * @return 供应商编码
     */
    @Transactional
    @Override
    public SupplierCode create(CreateSupplierCmd command) {
        // 生成供应商编码
        SupplierCode supplierCode = this.supplierCodeService.generateSerialNumber();
        // 将命令转换为供应商实体
        Supplier supplier = this.supplierAssembler.toAddEntity(command, supplierCode, SupplierStatus.POTENTIAL);
        // 添加到仓储
        this.supplierRepository.add(supplier);
        // 发布事件
        this.publisher.publishEvent(new SupplierCreatedEvent(this, supplierCode.getValue(), supplier.getName().getValue()));
        return supplierCode;
    }

    /**
     * 更新供应商信息
     *
     * @param command 更新供应商命令
     */
    @Transactional
    @Override
    public void update(UpdateSupplierCmd command) {
        // 将命令转换为供应商实体
        Supplier input = this.supplierAssembler.toUpdateEntity(command, SupplierStatus.POTENTIAL);
        // 从仓储中查找供应商
        Supplier supplier = this.supplierRepository.find(input.getSupplierCode());
        // 更新供应商信息
        supplier.update(input);
        // 更新到仓储
        this.supplierRepository.update(supplier);
    }

    /**
     * 移除供应商
     *
     * @param supplierCode 供应商编码
     */
    @Transactional
    @Override
    public void remove(SupplierCode supplierCode) {
        // 从仓储中查找供应商
        Supplier supplier = this.supplierRepository.find(supplierCode);
        // 检查是否可编辑
        supplier.checkEditable();
        // 从仓储中移除
        this.supplierRepository.removeAll(supplierCode);
    }

    /**
     * 添加供应商联系人
     *
     * @param supplierCode 供应商编码
     * @param command      添加供应商联系人命令
     * @return 供应商联系人编码
     */
    @Override
    public SupplierContactId addContact(SupplierCode supplierCode, AddSupplierContactCmd command) {
        // 从仓储中查找供应商
        Supplier supplier = this.supplierRepository.find(supplierCode);
        // 将命令转换为供应商联系人实体
        SupplierContact supplierContact = this.supplierAssembler.toAddEntity(supplierCode, command);
        // 添加联系人到供应商
        supplier.addContact(supplierContact);
        // 保存联系人到仓储并获取联系人编码
        SupplierContactId supplierContactId = this.supplierRepository.addOneSupplierContact(supplier);
        // 发布事件
        this.publisher.publishEvent(new SupplierContactCreatedEvent(this, supplierCode.getValue(),
                supplier.getName().getValue(), command.getPhone(), command.getName()));
        return supplierContactId;
    }

    /**
     * 更新供应商联系人信息
     *
     * @param supplierCode 供应商编码
     * @param command      更新供应商联系人命令
     */
    @Override
    public void updateContact(SupplierCode supplierCode, UpdateSupplierContactCmd command) {
        // 将命令转换为供应商联系人实体
        SupplierContact input = this.supplierAssembler.toUpdateEntity(supplierCode, command);
        // 从仓储中查找供应商联系人
        Supplier supplier = this.supplierRepository.findOneSupplierContact(
                supplierCode, input.getSupplierContactId()
        );
        // 更新联系人信息
        supplier.updateContact(input);
        // 更新到仓储
        this.supplierRepository.updateSupplierContact(supplier);
    }

    /**
     * 移除供应商联系人
     *
     * @param supplierCode      供应商编码
     * @param supplierContactId 供应商联系人编码
     */
    @Override
    public void removeContact(SupplierCode supplierCode, SupplierContactId supplierContactId) {
        // 从仓储中查找供应商联系人
        this.supplierRepository.findOneSupplierContact(supplierCode, supplierContactId);
        // 从仓储中移除联系人
        this.supplierRepository.removeOneSupplierContact(supplierContactId);
    }
}
```

### 创建适配层代码
> 包含持久层、事件监听器等基础实施和接口层

#### 创建持久层代码
- 创建数据对象类
```java
package com.island.isrm.core.supplier.port.repo.dao.dataobject;

import com.island.isrm.core.common.port.repo.BaseDataObject;
import jakarta.persistence.*;
import lombok.Data;
import lombok.EqualsAndHashCode;
import org.springframework.data.jpa.domain.support.AuditingEntityListener;

/**
 * 供应商数据对象类
 *
 * @author dao.ouyang
 * @since 2024-12-15
 */
@EqualsAndHashCode(callSuper = true)
@Data
@Entity
@Table(name = "supplier")
@EntityListeners(AuditingEntityListener.class)
public class SupplierDO extends BaseDataObject {
    /**
     * 供应商编码
     */
    @Id
    @Column(nullable = false, length = 32)
    private String supplierCode;

    /**
     * 供应商名称
     */
    private String name;

    /**
     * 供应商状态
     */
    @Column(length = 32)
    private String supplierStatus;
}
```
```java
package com.island.isrm.core.supplier.port.repo.dao.dataobject;

import com.island.isrm.core.common.port.repo.BaseDataObject;
import jakarta.persistence.*;
import lombok.Data;
import lombok.EqualsAndHashCode;
import org.springframework.data.jpa.domain.support.AuditingEntityListener;

/**
 * 供应商联系人数据对象
 *
 * @author dao.ouyang
 * @since 2024-12-15
 */
@EqualsAndHashCode(callSuper = true)
@Data
@Entity
@Table(name = "supplier_contact")
@EntityListeners(AuditingEntityListener.class)
public class SupplierContactDO extends BaseDataObject {
    /**
     * 主键ID
     */
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    /**
     * 供应商编码
     */
    @Column(nullable = false, length = 32)
    private String supplierCode;

    /**
     * 联系人姓名
     */
    private String name;

    /**
     * 联系电话
     */
    private String phone;
}
```
- 创建数据映射接口
```java
package com.island.isrm.core.supplier.port.repo.dao.projection;

/**
 * 供应商基本信息接口
 *
 * @author dao.ouyang
 * @since 2024-12-15
 */
public interface SupplierBasic {

    /**
     * 获取供应商编码
     *
     * @return 供应商编码
     */
    String getSupplierCode();

    /**
     * 获取供应商名称
     *
     * @return 供应商名称
     */
    String getName();

    /**
     * 获取供应商状态
     *
     * @return 供应商状态
     */
    String getSupplierStatus();
}
```
- 创建转换器，实体和数据对象之间进行转换
```java
package com.island.isrm.core.supplier.port.repo.dao;

import com.island.isrm.core.supplier.domain.entity.Supplier;
import com.island.isrm.core.supplier.port.repo.dao.dataobject.SupplierDO;
import org.mapstruct.Mapper;
import org.mapstruct.Mapping;
import org.mapstruct.factory.Mappers;

/**
 * 供应商实体与数据对象转换器接口
 *
 * @author dao.ouyang
 * @since 2024-12-15
 */
@Mapper(componentModel = "Spring")
public interface SupplierConverter {
    // SupplierConverter的实例，通过Mappers工具类获取，便于在需要的地方直接使用转换功能
    SupplierConverter INSTANCE = Mappers.getMapper(SupplierConverter.class);

    /**
     * 将供应商实体转换为供应商数据对象
     *
     * @param supplier 供应商实体，包含供应商的详细信息
     * @return 转换后的供应商数据对象，用于数据持久化
     */
    @Mapping(source = "supplierCode.value", target = "supplierCode")
    @Mapping(source = "name.value", target = "name")
    @Mapping(source = "supplierStatus", target = "supplierStatus")
    @Mapping(source = "version.value", target = "version")
    @Mapping(source = "createdBy.id", target = "createdBy")
    @Mapping(source = "createdDate.time", target = "createdDate")
    SupplierDO fromEntity(Supplier supplier);

    /**
     * 将供应商数据对象转换为供应商实体
     *
     * @param supplierDO 供应商数据对象，从数据库中获取的原始数据
     * @return 转换后的供应商实体，用于业务逻辑处理
     */
    @Mapping(target = "supplierCode.value", source = "supplierCode")
    @Mapping(target = "name.value", source = "name")
    @Mapping(target = "supplierStatus", source = "supplierStatus")
    @Mapping(target = "version.value", source = "version")
    @Mapping(target = "createdBy.id", source = "createdBy")
    @Mapping(target = "createdDate.time", source = "createdDate")
    Supplier toEntity(SupplierDO supplierDO);
}
```
- 创建数据访问对象
```java
package com.island.isrm.core.supplier.port.repo.dao;

import com.island.isrm.core.supplier.port.repo.dao.dataobject.SupplierDO;
import com.island.isrm.core.supplier.port.repo.dao.projection.SupplierBasic;
import com.island.isrm.core.supplier.port.repo.dao.projection.SupplierCodeAndName;
import org.springframework.data.domain.Page;
import org.springframework.data.domain.Pageable;
import org.springframework.data.jpa.repository.Query;
import org.springframework.data.repository.ListCrudRepository;
import org.springframework.stereotype.Repository;

import java.util.List;

/**
 * SupplierJpa接口用于定义供应商数据访问对象（DAO）的方法
 *
 * @author dao.ouyang
 * @since 2024-12-15
 */
@Repository
public interface SupplierJpa extends ListCrudRepository<SupplierDO, String> {

    /**
     * 查找供应商编码的最大值
     * 这个方法主要用于生成新的供应商编码，确保其唯一性和顺序性
     *
     * @return 最大的供应商编码字符串
     */
    @Query("select max(s.supplierCode) from SupplierDO s")
    String findMaxSupplierCode();

    /**
     * 按最后修改日期降序查找供应商基本信息
     * 该方法主要用于获取供应商列表，按照最后修改日期从新到旧排序
     *
     * @param pageable 分页请求对象，包含分页参数如页码和每页大小
     * @return 包含供应商基本信息的分页对象
     */
    @Query("SELECT s.supplierCode as supplierCode, s.name as name, s.supplierStatus as supplierStatus" +
            " FROM SupplierDO s ORDER BY s.lastModifiedDate DESC ")
    Page<SupplierBasic> findBasicOrderByLastModifiedDateDesc(Pageable pageable);

    /**
     * 列出所有供应商的编码和名称
     * 该方法主要用于获取所有供应商的简化信息，即编码和名称，通常用于列表展示或下拉菜单
     *
     * @return 包含供应商编码和名称的列表
     */
    @Query("SELECT s.supplierCode as code, s.name as name FROM SupplierDO s")
    List<SupplierCodeAndName> listCodeAndName();
}
```
- 创建仓储接口实现
```java
package com.island.isrm.core.supplier.port.repo.impl;

import com.island.isrm.core.common.exception.DataNotFoundException;
import com.island.isrm.core.supplier.domain.dp.SupplierCode;
import com.island.isrm.core.supplier.domain.dp.SupplierContactId;
import com.island.isrm.core.supplier.domain.entity.Supplier;
import com.island.isrm.core.supplier.domain.entity.SupplierContact;
import com.island.isrm.core.supplier.domain.repo.SupplierRepository;
import com.island.isrm.core.supplier.port.repo.dao.SupplierContactConverter;
import com.island.isrm.core.supplier.port.repo.dao.SupplierContactJpa;
import com.island.isrm.core.supplier.port.repo.dao.SupplierConverter;
import com.island.isrm.core.supplier.port.repo.dao.SupplierJpa;
import com.island.isrm.core.supplier.port.repo.dao.dataobject.SupplierContactDO;
import com.island.isrm.core.supplier.port.repo.dao.dataobject.SupplierDO;
import org.springframework.stereotype.Component;

import java.util.List;
import java.util.Optional;

/**
 * SupplierRepository的实现类，负责供应商相关的数据持久化操作
 *
 * @author dao.ouyang
 * @since 2024-12-15
 */
@Component
public class SupplierRepositoryImpl implements SupplierRepository {
    private final SupplierJpa supplierJpa;
    private final SupplierConverter supplierConverter;
    private final SupplierContactJpa supplierContactJpa;
    private final SupplierContactConverter supplierContactConverter;

    public SupplierRepositoryImpl(SupplierJpa supplierJpa, SupplierConverter supplierConverter,
                                  SupplierContactJpa supplierContactJpa, SupplierContactConverter supplierContactConverter) {
        this.supplierJpa = supplierJpa;
        this.supplierConverter = supplierConverter;
        this.supplierContactJpa = supplierContactJpa;
        this.supplierContactConverter = supplierContactConverter;
    }

    /**
     * 根据供应商编码查找供应商实体
     *
     * @param supplierCode 供应商编码
     * @return 供应商实体
     * @throws DataNotFoundException 如果找不到供应商，则抛出数据不存在异常
     */
    @Override
    public Supplier find(SupplierCode supplierCode) {
        Optional<SupplierDO> supplierDO = this.supplierJpa.findById(supplierCode.getValue());
        return this.supplierConverter.toEntity(supplierDO.orElseThrow(
                () -> new DataNotFoundException(String.format("供应商(%s)不存在", supplierCode.getValue()))
        ));
    }

    /**
     * 添加供应商实体
     *
     * @param supplier 供应商实体
     * @return 添加后的供应商编码
     */
    @Override
    public SupplierCode add(Supplier supplier) {
        SupplierDO supplierDO = this.supplierConverter.fromEntity(supplier);
        return new SupplierCode(this.supplierJpa.save(supplierDO).getSupplierCode());
    }

    /**
     * 更新供应商实体
     *
     * @param supplier 供应商实体
     */
    @Override
    public void update(Supplier supplier) {
        SupplierDO supplierDO = this.supplierConverter.fromEntity(supplier);
        this.supplierJpa.save(supplierDO);
    }

    /**
     * 删除供应商及其所有联系人
     *
     * @param supplierCode 供应商编码
     */
    @Override
    public void removeAll(SupplierCode supplierCode) {
        this.supplierJpa.deleteById(supplierCode.getValue());
        this.supplierContactJpa.deleteBySupplierCode(supplierCode.getValue());
    }

    /**
     * 查找特定供应商的特定联系人，并将其添加到供应商的联系人列表中
     *
     * @param supplierCode      供应商编码
     * @param supplierContactId 供应商联系人ID
     * @return 包含所需联系人的供应商实体
     * @throws DataNotFoundException 如果供应商或联系人不存在，则抛出数据不存在异常
     */
    @Override
    public Supplier findOneSupplierContact(SupplierCode supplierCode, SupplierContactId supplierContactId) {
        Supplier supplier = this.find(supplierCode);
        Optional<SupplierContactDO> supplierContactDO = this.supplierContactJpa.findByIdAndSupplierCode(
                supplierContactId.getId(), supplierCode.getValue()
        );
        SupplierContact supplierContact = this.supplierContactConverter.toEntity(supplierContactDO.orElseThrow(
                () -> new DataNotFoundException(String.format("供应商(%s)联系人(%d)不存在", supplierCode.getValue(), supplierContactId.getId()))
        ));
        supplier.getSupplierContacts().add(supplierContact);
        return supplier;
    }

    /**
     * 添加供应商联系人
     *
     * @param supplier 供应商实体，包含待添加的联系人
     * @return 添加后的供应商联系人ID
     * @throws DataNotFoundException 如果供应商或联系人列表为空，则抛出数据不存在异常
     */
    @Override
    public SupplierContactId addOneSupplierContact(Supplier supplier) {
        if (supplier == null || supplier.getSupplierContacts().isEmpty()) {
            throw new DataNotFoundException("供应商或供应商联系人列表不存在");
        }
        Optional<SupplierContact> supplierContactOptional = supplier.getSupplierContacts().stream()
                .filter(supplierContact -> supplierContact.getSupplierContactId() == null).findFirst();
        if (supplierContactOptional.isPresent()) {
            SupplierContactDO supplierContactDO = this.supplierContactConverter.fromEntity(supplierContactOptional.get());
            SupplierContactDO savedEntity = this.supplierContactJpa.save(supplierContactDO);
            return new SupplierContactId(savedEntity.getId());
        } else {
            throw new DataNotFoundException("没有添加供应商联系人");
        }
    }

    /**
     * 更新供应商的所有联系人
     *
     * @param supplier 供应商实体，包含所有待更新的联系人
     */
    @Override
    public void updateSupplierContact(Supplier supplier) {
        List<SupplierContactDO> supplierContactDOList = supplier.getSupplierContacts().stream().
                map(this.supplierContactConverter::fromEntity).toList();
        this.supplierContactJpa.saveAll(supplierContactDOList);
    }

    /**
     * 删除供应商的特定联系人
     *
     * @param supplierContactId 供应商联系人ID
     */
    @Override
    public void removeOneSupplierContact(SupplierContactId supplierContactId) {
        this.supplierContactJpa.deleteById(supplierContactId.getId());
    }
}
```
- 创建查询服务类
```java
package com.island.isrm.core.supplier.port.repo.service;

import com.island.isrm.core.supplier.port.repo.dao.SupplierContactJpa;
import com.island.isrm.core.supplier.port.repo.dao.SupplierJpa;
import com.island.isrm.core.supplier.port.repo.dao.dataobject.SupplierContactDO;
import com.island.isrm.core.supplier.port.repo.dao.dataobject.SupplierDO;
import com.island.isrm.core.supplier.port.repo.dao.projection.ContactNameAndPhone;
import com.island.isrm.core.supplier.port.repo.dao.projection.SupplierBasic;
import com.island.isrm.core.supplier.port.repo.dao.projection.SupplierCodeAndName;
import com.island.isrm.core.supplier.port.repo.dao.projection.SupplierContactBasic;
import org.springframework.data.domain.Page;
import org.springframework.data.domain.Pageable;
import org.springframework.stereotype.Service;

import java.util.List;

/**
 * 供应商查询服务类，提供与供应商相关的查询操作
 *
 * @author dao.ouyang
 * @since 2024-12-15
 */
@Service
public class SupplierQueryService {
    // 供应商数据访问对象
    private final SupplierJpa supplierJpa;
    // 供应商联系人数据访问对象
    private final SupplierContactJpa supplierContactJpa;

    /**
     * 构造函数，初始化供应商查询服务类
     *
     * @param supplierJpa        供应商数据访问对象
     * @param supplierContactJpa 供应商联系人数据访问对象
     */
    public SupplierQueryService(SupplierJpa supplierJpa, SupplierContactJpa supplierContactJpa) {
        this.supplierJpa = supplierJpa;
        this.supplierContactJpa = supplierContactJpa;
    }

    /**
     * 分页查询供应商基本信息
     *
     * @param pageable 分页参数
     * @return 供应商基本信息的分页结果
     */
    public Page<SupplierBasic> pageBasic(Pageable pageable) {
        return this.supplierJpa.findBasicOrderByLastModifiedDateDesc(pageable);
    }

    /**
     * 查询所有供应商的编码和名称
     *
     * @return 供应商编码和名称的列表
     */
    public List<SupplierCodeAndName> listCodeAndName() {
        return this.supplierJpa.listCodeAndName();
    }

    /**
     * 根据供应商编码查找供应商详细信息
     *
     * @param supplierCode 供应商编码
     * @return 供应商详细信息对象，如果找不到则返回空的供应商对象
     */
    public SupplierDO find(String supplierCode) {
        return this.supplierJpa.findById(supplierCode).orElse(new SupplierDO());
    }

    /**
     * 根据供应商编码查询供应商联系人基本信息
     *
     * @param supplierCode 供应商编码
     * @return 供应商联系人基本信息列表
     */
    public List<SupplierContactBasic> listContactBasic(String supplierCode) {
        return this.supplierContactJpa.findContactBasicBySupplierCode(supplierCode);
    }

    /**
     * 根据供应商编码查询供应商联系人的姓名和电话
     *
     * @param supplierCode 供应商编码
     * @return 联系人姓名和电话列表
     */
    public List<ContactNameAndPhone> listContactNameAndPhone(String supplierCode) {
        return this.supplierContactJpa.listContactNameAndPhone(supplierCode);
    }

    /**
     * 根据联系人ID和供应商编码查找供应商联系人详细信息
     *
     * @param id           联系人ID
     * @param supplierCode 供应商编码
     * @return 供应商联系人详细信息对象，如果找不到则返回空的联系人对象
     */
    public SupplierContactDO findContact(Long id, String supplierCode) {
        return this.supplierContactJpa.findByIdAndSupplierCode(id, supplierCode).orElse(new SupplierContactDO());
    }
}
```

#### 创建应用服务实现
```java
package com.island.isrm.core.supplier.port.external;

import com.island.isrm.core.supplier.domain.dp.SupplierCode;
import com.island.isrm.core.supplier.domain.external.SupplierCodeService;
import com.island.isrm.core.supplier.port.repo.dao.SupplierJpa;
import org.springframework.stereotype.Service;
import org.springframework.util.StringUtils;

/**
 * 供应商编码服务数据库实现类
 *
 * @author dao.ouyang
 * @since 2024-12-15
 */
@Service
public class SupplierCodeServiceDb implements SupplierCodeService {
    // 注入SupplierJpa用于访问数据库
    private final SupplierJpa supplierJpa;

    /**
     * 构造函数注入SupplierJpa
     *
     * @param supplierJpa SupplierJpa实例，用于与数据库交互
     */
    public SupplierCodeServiceDb(SupplierJpa supplierJpa) {
        this.supplierJpa = supplierJpa;
    }

    /**
     * 生成供应商编码
     * 该方法首先尝试从数据库中获取最大的供应商编码，如果存在，则在此基础上生成新的编码；
     * 如果不存在，则生成初始编码"S1000"。
     *
     * @return 新的供应商编码
     */
    @Override
    public SupplierCode generateSerialNumber() {
        // 尝试获取数据库中的最大供应商编码
        String maxSupplierCode = this.supplierJpa.findMaxSupplierCode();
        if (StringUtils.hasText(maxSupplierCode)) {
            // 如果最大编码存在，则解析其数字部分，加一后生成新的编码
            Integer maxSerialNumber = Integer.parseInt(maxSupplierCode.substring(1));
            return new SupplierCode(String.format("S%d", maxSerialNumber + 1));
        } else {
            // 如果最大编码不存在，则生成初始编码"S1000"
            return new SupplierCode("S1000");
        }
    }
}
```

#### 创建事件监听器
```java
package com.island.isrm.core.idaccess.port.message;

import com.island.isrm.core.common.domain.event.SupplierContactCreatedEvent;
import com.island.isrm.core.common.domain.event.SupplierCreatedEvent;
import com.island.isrm.core.idaccess.application.UserAppService;
import org.springframework.context.event.EventListener;
import org.springframework.stereotype.Component;

@Component
public class SupplierUserCreationListener {
    private final UserAppService userAppService;

    public SupplierUserCreationListener(UserAppService userAppService) {
        this.userAppService = userAppService;
    }

    @EventListener
    public void handleSupplierCreatedEvent(SupplierCreatedEvent event) {
        // 根据供应商编码创建用户.
        this.userAppService.create(event);
    }

    @EventListener
    public void handleSupplierContactCreatedEvent(SupplierContactCreatedEvent event) {
        // 根据供应商编码创建用户.
        this.userAppService.create(event);
    }
}
```

#### 创建API接口
```java
package com.island.isrm.core.supplier.port.api;

import com.island.isrm.core.supplier.application.SupplierAppService;
import com.island.isrm.core.supplier.application.command.AddSupplierContactCmd;
import com.island.isrm.core.supplier.application.command.CreateSupplierCmd;
import com.island.isrm.core.supplier.application.command.UpdateSupplierCmd;
import com.island.isrm.core.supplier.application.command.UpdateSupplierContactCmd;
import com.island.isrm.core.supplier.domain.dp.SupplierCode;
import com.island.isrm.core.supplier.domain.dp.SupplierContactId;
import com.island.isrm.core.supplier.port.repo.dao.dataobject.SupplierContactDO;
import com.island.isrm.core.supplier.port.repo.dao.dataobject.SupplierDO;
import com.island.isrm.core.supplier.port.repo.dao.projection.ContactNameAndPhone;
import com.island.isrm.core.supplier.port.repo.dao.projection.SupplierBasic;
import com.island.isrm.core.supplier.port.repo.dao.projection.SupplierCodeAndName;
import com.island.isrm.core.supplier.port.repo.dao.projection.SupplierContactBasic;
import com.island.isrm.core.supplier.port.repo.service.SupplierQueryService;
import lombok.extern.slf4j.Slf4j;
import org.springframework.data.domain.Page;
import org.springframework.data.domain.PageRequest;
import org.springframework.web.bind.annotation.*;

import java.util.List;

/**
 * SupplierRest类提供了供应商管理的RESTful API接口
 *
 * @author dao.ouyang
 * @since 2024-12-15
 */
@Slf4j
@RestController
@RequestMapping("/v1/supplier")
public class SupplierRest {
    private final SupplierQueryService supplierQueryService;
    private final SupplierAppService supplierAppService;

    public SupplierRest(SupplierQueryService supplierQueryService, SupplierAppService supplierAppService) {
        this.supplierQueryService = supplierQueryService;
        this.supplierAppService = supplierAppService;
    }

    /**
     * 分页获取供应商基本信息
     *
     * @param pageNumber 页码
     * @param pageSize   每页大小
     * @return 供应商基本信息的分页结果
     */
    @GetMapping("/page/basic")
    public Page<SupplierBasic> pageBasic(@RequestParam Integer pageNumber, @RequestParam Integer pageSize) {
        return supplierQueryService.pageBasic(PageRequest.of(pageNumber, pageSize));
    }

    /**
     * 获取所有供应商的编码和名称列表
     *
     * @return 供应商编码和名称的列表
     */
    @GetMapping("/list/code/name")
    public List<SupplierCodeAndName> listCodeAndName() {
        return supplierQueryService.listCodeAndName();
    }

    /**
     * 根据供应商编码查找供应商详细信息
     *
     * @param supplierCode 供应商编码
     * @return 供应商详细信息
     */
    @GetMapping("/{supplierCode}")
    public SupplierDO find(@PathVariable String supplierCode) {
        return supplierQueryService.find(supplierCode);
    }

    /**
     * 创建新供应商
     *
     * @param command 创建供应商的命令对象
     * @return 新创建供应商的编码
     */
    @PostMapping("/create")
    public String create(@RequestBody CreateSupplierCmd command) {
        return supplierAppService.create(command).getValue();
    }

    /**
     * 更新供应商信息
     *
     * @param command 更新供应商的命令对象
     */
    @PostMapping("/update")
    public void update(@RequestBody UpdateSupplierCmd command) {
        supplierAppService.update(command);
    }

    /**
     * 删除供应商
     *
     * @param supplierCode 供应商编码
     */
    @PostMapping("/remove/{supplierCode}")
    public void remove(@PathVariable String supplierCode) {
        supplierAppService.remove(new SupplierCode(supplierCode));
    }

    /**
     * 获取供应商的联系人基本信息列表
     *
     * @param supplierCode 供应商编码
     * @return 供应商联系人基本信息列表
     */
    @GetMapping("/{supplierCode}/contact/list")
    public List<SupplierContactBasic> listContactBasic(@PathVariable String supplierCode) {
        return supplierQueryService.listContactBasic(supplierCode);
    }

    /**
     * 获取供应商的联系人姓名和电话列表
     *
     * @param supplierCode 供应商编码
     * @return 供应商联系人姓名和电话列表
     */
    @GetMapping("/{supplierCode}/contact/list/name/phone")
    public List<ContactNameAndPhone> listContact(@PathVariable String supplierCode) {
        return supplierQueryService.listContactNameAndPhone(supplierCode);
    }

    /**
     * 根据联系人ID和供应商编码查找联系人详细信息
     *
     * @param supplierContactId 联系人ID
     * @param supplierCode      供应商编码
     * @return 联系人详细信息
     */
    @GetMapping("/{supplierCode}/contact/{supplierContactId}")
    public SupplierContactDO findContact(@PathVariable Long supplierContactId, @PathVariable String supplierCode) {
        return supplierQueryService.findContact(supplierContactId, supplierCode);
    }

    /**
     * 为供应商添加新联系人
     *
     * @param supplierCode 供应商编码
     * @param command      添加供应商联系人的命令对象
     * @return 新添加联系人的ID
     */
    @PostMapping("/{supplierCode}/contact/add")
    public Long addContact(@PathVariable String supplierCode, @RequestBody AddSupplierContactCmd command) {
        return supplierAppService.addContact(new SupplierCode(supplierCode), command).getId();
    }

    /**
     * 更新供应商联系人信息
     *
     * @param supplierCode 供应商编码
     * @param command      更新供应商联系人的命令对象
     */
    @PostMapping("/{supplierCode}/contact/update")
    public void updateContact(@PathVariable String supplierCode, @RequestBody UpdateSupplierContactCmd command) {
        supplierAppService.updateContact(new SupplierCode(supplierCode), command);
    }

    /**
     * 删除供应商联系人
     *
     * @param supplierCode      供应商编码
     * @param supplierContactId 联系人ID
     */
    @PostMapping("/{supplierCode}/contact/remove/{supplierContactId}")
    public void removeContact(@PathVariable String supplierCode, @PathVariable Long supplierContactId) {
        supplierAppService.removeContact(new SupplierCode(supplierCode), new SupplierContactId(supplierContactId));
    }
}
```

## 创建前端代码
> 前端代码主要有http请求、路由、页面视图、组件等

### 添加http请求
```javascript
// ------ 供应商 ------
// 获取供应商列表
export const getSupplierList = (pageNumber, pageSize) =>
    service.get("/v1/supplier/page/basic?pageNumber=".concat(pageNumber - 1).concat("&pageSize=").concat(pageSize));
// 获取精简供应商列表
export const getThinSupplierList = () =>
    service.get("/v1/supplier/list/code/name");
// 获取供应商详情
export const getSupplier = (supplierCode) =>
    service.get("/v1/supplier/".concat(supplierCode));
// 创建供应商
export const saveSupplier = (supplier) =>
    service.post("/v1/supplier/create", supplier);
// 更新供应商信息
export const updateSupplier = (supplier) =>
    service.post("/v1/supplier/update", supplier);
// 删除供应商
export const delSupplier = (supplierCode) =>
    service.post("/v1/supplier/remove/".concat(supplierCode));

// ------ 供应商联系人 ------
// 获取供应商联系人列表
export const getSupplierContactList = (supplierCode) =>
    service.get("/v1/supplier/".concat(supplierCode).concat("/contact/list"));
// 获取供应商联系人列表
export const getThinContactList = (supplierCode) =>
    service.get("/v1/supplier/".concat(supplierCode).concat("/contact/list/name/phone"));
// 获取供应商联系人详情
export const getSupplierContact = (supplierCode, supplierContactId) =>
    service.get(
        "/v1/supplier/".concat(supplierCode).concat("/contact/").concat(supplierContactId)
    );
// 新增供应商联系人
export const saveSupplierContact = (supplierCode, product) =>
    service.post(
        "/v1/supplier/".concat(supplierCode).concat("/contact/add"),
        product
    );
// 更新供应商联系人信息
export const updateSupplierContact = (supplierCode, product) =>
    service.post(
        "/v1/supplier/".concat(supplierCode).concat("/contact/update"),
        product
    );
// 删除供应商联系人
export const delSupplierContact = (supplierCode, supplierContactId) =>
    service.post(
        "/v1/supplier/"
            .concat(supplierCode)
            .concat("/contact/remove/")
            .concat(supplierContactId)
    );
```

### 添加路由
```javascript
// ------ 供应商 ------
{
    path: "supplier/list",
    name: "supplier",
    component: () => import("@/views/supplier/ListView.vue"),
},
{
    path: "supplier/edit/:supplierCode",
    component: () => import("@/views/supplier/EditView.vue"),
},
{
    path: "supplier/contact/list/:supplierCode",
    component: () => import("@/views/supplier/contact/ListEditView.vue"),
}
```

### 创建组件
- 创建表单组件
```vue
<script setup>
import {Col, Form, FormItem, Input, Row} from "view-ui-plus";
import SupplierStatusSelect from "@/components/supplier/SupplierStatusSelect.vue";

const props = defineProps({
  supplier: {type: Object, required: true}
});
</script>

<template>
  <Form :model="supplier" label-position="top">
    <Row>
      <Col span="8">
        <FormItem label="编码">
          <Input v-model="supplier.supplierCode" disabled/>
        </FormItem>
      </Col>
      <Col span="16">
        <FormItem label="名称">
          <Input v-model="supplier.name"/>
        </FormItem>
      </Col>
    </Row>
    <Row>
      <Col span="8">
        <FormItem label="状态">
          <SupplierStatusSelect v-model="supplier.supplierStatus" disabled/>
        </FormItem>
      </Col>
    </Row>
    <slot></slot>
  </Form>
</template>

<style scoped>

</style>
```
- 创建表单包含的小组件
```vue
<script setup>
import {Option, Select} from "view-ui-plus";

const model = defineModel()
defineProps({
  compType: {type: String, default: 'select'}
});
</script>

<template>
  <Select v-if="compType === 'select'" v-model="model">
    <Option value="POTENTIAL">潜在</Option>
    <Option value="INTRODUCING">引入中</Option>
    <Option value="QUALIFIED">合格</Option>
    <Option value="EXITED">已退出</Option>
  </Select>
  <div v-else>
    <span v-if="model === 'POTENTIAL'">潜在</span>
    <span v-else-if="model === 'INTRODUCING'">引入中</span>
    <span v-else-if="model === 'QUALIFIED'">合格</span>
    <span v-else-if="model === 'EXITED'">已退出</span>
  </div>
</template>

<style scoped>

</style>
```
- 创建表格组件
```vue
<script setup>
import {Table} from "view-ui-plus";
import SupplierStatusSelect from "@/components/supplier/SupplierStatusSelect.vue";

const columns = [
  {title: "序号", type: "index", width: 80},
  {
    title: "编码",
    key: "supplierCode",
  },
  {
    title: "名称",
    slot: "name",
  },
  {
    title: "状态",
    slot: "supplierStatus"
  },
  {
    title: "操作",
    slot: "action",
    width: 150,
    align: "center",
  },
];
defineProps({
  loading: Boolean,
  supplierList: {type: Object, required: true},
});
</script>

<template>
  <Table :loading="loading" stripe :columns="columns" :data="supplierList">
    <template #name="{ row }">
      <strong>{{ row.name }}</strong>
    </template>
    <template #supplierStatus="{ row }">
      <SupplierStatusSelect v-model="row.supplierStatus" comp-type="span"/>
    </template>
    <template #action="{ row, index }">
      <slot :row="row" :index="index"></slot>
    </template>
  </Table>
</template>

<style scoped>

</style>
```
- 创建其他组件，封装给其他模块使用
```vue
<script setup>
import {Option, Select} from "view-ui-plus";
import {onMounted, ref} from "vue";
import {getThinSupplierList} from "@/http/api";

const code = defineModel('code');
const name = defineModel('name');

const supplierList = ref([])

onMounted(() => {
  getThinSupplierList().then(data => {
    supplierList.value = data;
  })
})

function selectSupplier(selection) {
  name.value = selection.label;
}
</script>

<template>
  <Select v-model="code" @on-select="selectSupplier" label-in-value filterable>
    <Option v-for="item in supplierList" :key="item.code" :value="item.code">{{ item.name }}</Option>
  </Select>
</template>

<style scoped>

</style>
```

### 创建视图
- 创建列表页
```vue
<script setup>
import {Button, Message, PageHeader, Poptip} from "view-ui-plus";
import SupplierTable from "@/components/supplier/SupplierTable.vue";
import {onMounted, ref} from "vue";
import {delSupplier, getSupplierList} from "@/http/api";
import {useRouter} from "vue-router";

const loading = ref(true);
const supplierList = ref([]);
const pageTotal = ref(0);
const pageSize = ref(20);

onMounted(() => {
  initSupplierList(1);
});

function initSupplierList(pageNumber) {
  getSupplierList(pageNumber, pageSize.value).then((data) => {
    supplierList.value = data.content;
    loading.value = false;
    pageTotal.value = data.totalElements;
  });
}

function onPageSizeChange(size) {
  pageSize.value = size;
  initSupplierList(1);
}

const router = useRouter();

function show(supplierCode) {
  router.push("/main/supplier/edit/" + supplierCode);
}

function remove(supplierCode) {
  delSupplier(supplierCode).then(() => {
    Message.info("删除成功,编号: " + supplierCode);
    initSupplierList(1);
  });
}
</script>

<template>
  <PageHeader>
    <template #title>供应商管理</template>
    <template #action>
      <Button type="primary" to="/main/supplier/edit/undefined">新增</Button>
    </template>
  </PageHeader>
  <SupplierTable :loading="loading" :supplier-list="supplierList" v-slot="{row, index}">
    <Button type="primary" size="small" style="margin-right: 5px" @click="show(row.supplierCode)">查看</Button>
    <Poptip confirm transfer @on-ok="remove(row.supplierCode)">
      <Button type="error" size="small">删除</Button>
      <template #title>
        <span>确定要删除{{ row.name }}?</span>
      </template>
    </Poptip>
  </SupplierTable>
  <Page :total="pageTotal" :page-size="pageSize" @on-change="initSupplierList"
        @on-page-size-change="onPageSizeChange" show-sizer show-total/>
</template>

<style scoped>

</style>
```
- 创建编辑页
```vue
<script setup>
import {Button, ButtonGroup, Card, Col, FormItem, Icon, Message, Modal, PageHeader, Row} from "view-ui-plus";
import SupplierForm from "@/components/supplier/SupplierForm.vue";
import {useRoute, useRouter} from "vue-router";
import {onMounted, ref} from "vue";
import {getSupplier, saveSupplier, updateSupplier} from "@/http/api";

const route = useRoute();
const router = useRouter();
const supplierCode = ref(route.params.supplierCode);
const supplier = ref({});

onMounted(() => {
  initSupplier();
});

function initSupplier() {
  getSupplier(supplierCode.value).then((data) => {
    supplier.value = data;
  });
}

function update() {
  if (!!supplier.value.supplierCode) {
    updateSupplier(supplier.value).then(() => {
      Message.info("更新成功,编号: " + supplierCode.value);
    });
  } else {
    saveSupplier(supplier.value).then((id) => {
      supplierCode.value = id;
      Modal.confirm({
        title: '成功',
        content: `保存成功,编号: ${supplierCode.value}`,
        okText: '查看详情',
        cancelText: '继续新增',
        onOk: () => {
          initSupplier();
          router.push(`/main/supplier/edit/${supplierCode.value}`);
        },
        onCancel: () => {
          supplier.value = {};
          supplierCode.value = 'undefined';
          router.push('/main/supplier/edit/undefined');
        }
      })
    });
  }
}

function handleReset() {
  supplier.value.name = null;
}
</script>

<template>
  <PageHeader title="供应商" back @on-back="router.push('/main/supplier/list')">
    <template #action>
      <ButtonGroup v-if="supplierCode !== 'undefined'">
        <Button type="primary" :to="`/main/supplier/contact/list/${supplierCode}`">联系人</Button>
      </ButtonGroup>
    </template>
  </PageHeader>
  <Row>
    <Col span="12" offset="6">
      <Card>
        <template #title>
          <Icon type="ios-book"/>
          询价详情
        </template>
        <SupplierForm :supplier="supplier"
                      :disabled="supplier.supplierStatus !== 'POTENTIAL' && supplierCode !== 'undefined'">
          <FormItem>
            <Button type="primary" @click="update">保存</Button>
            <Button @click="handleReset()" style="margin-left: 8px">重置</Button>
          </FormItem>
        </SupplierForm>
      </Card>
    </Col>
  </Row>
</template>

<style scoped>

</style>
```